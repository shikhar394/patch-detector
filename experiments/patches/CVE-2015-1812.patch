From feb2703adb0c121705e5c8e9ddf8f663b6481cbd Mon Sep 17 00:00:00 2001
From: Kohsuke Kawaguchi <kk@kohsuke.org>
Date: Sat, 7 Mar 2015 10:28:40 -0800
Subject: [PATCH 1/2] [FIXED SECURITY-171]

---
 core/src/main/java/hudson/util/FormValidation.java | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/core/src/main/java/hudson/util/FormValidation.java b/core/src/main/java/hudson/util/FormValidation.java
index 8190dab1f15..396fe796496 100644
--- a/core/src/main/java/hudson/util/FormValidation.java
+++ b/core/src/main/java/hudson/util/FormValidation.java
@@ -196,7 +196,7 @@ private static FormValidation _error(Kind kind, Throwable e, String message) {
             " <a href='#' class='showDetails'>"
             + Messages.FormValidation_Error_Details()
             + "</a><pre style='display:none'>"
-            + Functions.printThrowable(e) +
+            + Util.escape(Functions.printThrowable(e)) +
             "</pre>",kind
         );
     }

From f880d8d2cd9d46987ee3630fa04f77b17784f4e8 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Oliver=20Gond=C5=BEa?= <ogondza@gmail.com>
Date: Sat, 7 Mar 2015 20:32:17 +0100
Subject: [PATCH 2/2] [SECURITY-171] test

---
 core/src/test/java/hudson/util/FormValidationTest.java | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/core/src/test/java/hudson/util/FormValidationTest.java b/core/src/test/java/hudson/util/FormValidationTest.java
index 281a11f1528..1840a54e3fc 100644
--- a/core/src/test/java/hudson/util/FormValidationTest.java
+++ b/core/src/test/java/hudson/util/FormValidationTest.java
@@ -23,6 +23,10 @@
  */
 package hudson.util;
 
+import static org.hamcrest.CoreMatchers.containsString;
+import static org.hamcrest.CoreMatchers.not;
+import static org.hamcrest.MatcherAssert.assertThat;
+
 import junit.framework.TestCase;
 
 /**
@@ -51,4 +55,9 @@ public void testValidateRequired_Empty() {
     public void testMessage() {
         assertEquals("test msg", FormValidation.errorWithMarkup("test msg").getMessage());
     }
+
+    public void testFormValidationException() {
+        FormValidation fv = FormValidation.error(new Exception("<html"), "Message<html");
+        assertThat(fv.renderHtml(), not(containsString("<html")));
+    }
 }